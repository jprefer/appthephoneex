define(['require', 'app'],
    function(require, APP) {
        /**
         * Controller for Login_clone_1 generated by Appery.io
         * @module Login_clone_1
         */
        APP.controller('Login_clone_1', ['$scope', 'Apperyio', controller]);

        function controller($scope, Apperyio) {
            /**
             * user controller variables
             */
            $scope.user = Apperyio.EntityAPI('User');
            $scope.UserType = Apperyio.EntityAPI('String');
            $scope.devID = Apperyio.EntityAPI('String');
            $scope.timeZone = Apperyio.EntityAPI('String');
            $scope.shift = Apperyio.EntityAPI('String');
            $scope.channel = Apperyio.EntityAPI('String');
            $scope.message = Apperyio.EntityAPI('String');
            $scope.device_id = Apperyio.EntityAPI('String');
            $scope.insertID = Apperyio.EntityAPI('String');
            $scope.insertUser = Apperyio.EntityAPI('String');
            $scope.dev_vars = Apperyio.EntityAPI('Dev');
            /**
             * User controller functions
             */
            /**
             * @function init
             */
            $scope.init = function() {
                //On load screen logic
            };
            /**
             * @function login
             */
            $scope.login = function() {
                var requestData = {};
                var dev_id = "holp"
                requestData = (function mapping4383($scope) {
                    var requestData = {};
                    requestData.params = Apperyio.EntityAPI('LoginUser_service.request.query', undefined, true);
                    var user_scope = $scope.user;
                    requestData.params.username = user_scope.username;
                    requestData.params.password = user_scope.password;
                    return requestData;
                    /*|button_mapping|onbeforesend|04A0AE60-CF15-43FF-A483-C79FCD7361B0||4383|*/
                })($scope);
                // Get Login Service
                Apperyio.get("LoginUser_service")(requestData).then(
                    /*|service_bookmark|bookmark|04A0AE60-CF15-43FF-A483-C79FCD7361B0||1044|*/
                    function(success) { // success callback
                        /*|button_mapping|onsuccess|04A0AE60-CF15-43FF-A483-C79FCD7361B0||2693|*/
                        var userData = Apperyio.get("dataStorage");
                        userData.current = success.data;
                        console.log(userData);
                        var AllData = userData.current;
                        var turn = AllData.UserType;
                        //Thenext line was added to get user
                        var dev_user = AllData.username;
                        //The next lines are added to get the deviceid and register push notifications
                        //Thenext line was added to get user
                        $scope.timeZone = "GMT-04:00";
                        document.addEventListener("push-notification", function(event) {
                            alert(event.detail.message);
                        });
                        var requestData = {};
                        /*|button_mapping|onbeforesend|2433A3E7-057D-1695-F2C7-EA3E86BFACE9||8899|*/
                        // read more about using rest services: https://links.appery.io/ve-snippet-rest
                        Apperyio.get("PushRegisterDevice")(requestData).then(
                            /*|service_bookmark|bookmark|2433A3E7-057D-1695-F2C7-EA3E86BFACE9||7372|*/
                            function(success) { // success callback
                                (function mapping1555(success, $scope) {
                                    var devID_scope = $scope.devID;
                                    devID_scope = success.deviceID;
                                    $scope.devID = devID_scope;
                                    alert("Success. \n" + "Device ID: " + $scope.devID);
                                    /*|button_mapping|onsuccess|2433A3E7-057D-1695-F2C7-EA3E86BFACE9||1555|*/
                                })(success, $scope);
                            },
                            function(error) { // callback to handle request error
                            },
                            function(notify) { // notify callback, can fire few times
                            });
                        //Below this is the path the program takes depending on buyer or seller
                        if (turn == "S") {
                            Apperyio.navigateTo("Seller_Home", {});
                        } else {
                            Apperyio.navigateTo("Buyer_Home", {});
                        }
                    },
                    function(error) { // callback to handle request error
                        var modalOptions = { // About Ionic Modal: https://devcenter.appery.io/documentation/angularjs/screens/#Modal_screen
                            animation: 'slide-in-up', // The animation to show & hide with
                            focusFirstInput: false, // Whether to autofocus the first input of the modal when shown
                            backdropClickToClose: true, // Whether to close the modal on clicking the backdrop
                            hardwareBackButtonClose: true // Whether the modal can be closed using the hardware back button on Android and similar devices
                        };
                        Apperyio.get('Modals').loadModal("MessagePopup").then(
                            function(modalInstance) {
                                modalInstance.open(modalOptions).then(function(modal) {
                                    modal.scope.modal = modal;
                                    modal.show();
                                });
                            },
                            function(error) {
                                console.log(error);
                            });
                    },
                    function(notify) { // notify callback, can fire few times
                    });
            };
        }
    });