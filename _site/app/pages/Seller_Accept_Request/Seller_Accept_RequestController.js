define(['require', 'app'],
    function(require, APP) {
        /**
         * Controller for Seller_Accept_Request generated by Appery.io
         * @module Seller_Accept_Request
         */
        APP.controller('Seller_Accept_Request', ['$scope', 'Apperyio', controller]);

        function controller($scope, Apperyio) {
            /**
             * user controller variables
             */
            $scope.RequestID2 = Apperyio.EntityAPI('DataStorage');
            $scope.RequestID3 = Apperyio.EntityAPI('String');
            $scope.Buyer_username1 = Apperyio.EntityAPI('String');
            $scope.manufacturer1 = Apperyio.EntityAPI('String');
            $scope.Product1 = Apperyio.EntityAPI('String');
            $scope.Memory1 = Apperyio.EntityAPI('String');
            $scope.Color1 = Apperyio.EntityAPI('String');
            $scope.Condition1 = Apperyio.EntityAPI('String');
            $scope.Quantity1 = Apperyio.EntityAPI('Number');
            $scope.B_Requests1A = Apperyio.EntityAPI('String');
            $scope.B_Requests2A = Apperyio.EntityAPI('String');
            $scope.B_Requests3A = Apperyio.EntityAPI('String');
            $scope.B_Requests4A = Apperyio.EntityAPI('String');
            $scope.B_Requests5A = Apperyio.EntityAPI('String');
            $scope.RNotes1 = Apperyio.EntityAPI('String');
            $scope._createdAt1 = Apperyio.EntityAPI('String');
            $scope.RequestID4 = Apperyio.EntityAPI('String');
            $scope.miniID = Apperyio.EntityAPI('String');
            $scope.Seller_username = Apperyio.EntityAPI('String');
            $scope.Shipping1 = Apperyio.EntityAPI('String');
            $scope.Carrier1 = Apperyio.EntityAPI('String');
            $scope.Kitted1 = Apperyio.EntityAPI('String');
            $scope.token = Apperyio.EntityAPI('String');
            /**
             * User controller functions
             */
            /**
             * @function init
             */
            $scope.init = function() {
                //On load screen logic
                var RequestID3 = ""
                // inject the 'dataStorage' service
                var data = Apperyio.get("dataStorage");
                // user1 is a variable in the page1 scope 
                // set it to reference the 'dataStorage' service
                $scope.RequestID2.Gl_Vars = data;
                //console.log($scope.RequestID2.Gl_Vars.request_id);
                RequestID3 = $scope.RequestID2.Gl_Vars.request_id;
                //console.log("RequestID3= ",RequestID3);
                var miniID;
                //$scope.BidAmount = 999.99
                //Get User
                var userData = Apperyio.get("dataStorage");
                var AllData = userData.current;
                var username = AllData.username;
                var Buyer_username = AllData.username;
                var token = AllData.session;
                //Get User  
                // Get Data from Request
                var requestData = {};
                requestData = (function mapping6403($scope) {
                    var requestData = {};
                    requestData.params = {};
                    var RequestID3_scope = $scope.RequestID3;
                    requestData.params.CurrentRequestID = RequestID3;
                    requestData.headers = {};
                    var token_scope = $scope.token;
                    requestData.headers['X-Appery-Session-Token'] = token;
                    // console.log("token",token);
                    return requestData;
                    /*|button_mapping|onbeforesend|40707D72-9839-CE41-614A-E5ECC1D8F358||6403|*/
                })($scope);
                // read more about using rest services: https://links.appery.io/ve-snippet-rest
                Apperyio.get("Request_To_Seller_Detail_service")(requestData).then(
                    /*|service_bookmark|bookmark|40707D72-9839-CE41-614A-E5ECC1D8F358||1670|*/
                    function(success) { // success callback
                        (function mapping1577(success, $scope) {
                            var Buyer_username1_scope = $scope.Buyer_username1;
                            var manufacturer1_scope = $scope.manufacturer1;
                            var Product1_scope = $scope.Product1;
                            var Memory1_scope = $scope.Memory1;
                            var Color1_scope = $scope.Color1;
                            var Carrier1_scope = $scope.Carrier1;
                            var Kitted1_scope = $scope.Kitted1;
                            var Quantity1_scope = $scope.Quantity1;
                            var B_Requests1A_scope = $scope.B_Requests1A;
                            var B_Requests2A_scope = $scope.B_Requests2A;
                            var B_Requests3A_scope = $scope.B_Requests3A;
                            var B_Requests4A_scope = $scope.B_Requests4A;
                            var B_Requests5A_scope = $scope.B_Requests5A;
                            var RNotes1_scope = $scope.RNotes1;
                            var Shipping1_scope = $scope.Shipping1;
                            var _createdAt1_scope = $scope._createdAt1;
                            var RequestID4_scope = $scope.RequestID4;
                            Buyer_username1_scope = success.data[0].Buyer_username;
                            manufacturer1_scope = success.data[0].manufacturer;
                            Product1_scope = success.data[0].Product;
                            Memory1_scope = success.data[0].Memory;
                            Color1_scope = success.data[0].Color;
                            Carrier1_scope = success.data[0].Carrier;
                            Kitted1_scope = success.data[0].Kitted;
                            Quantity1_scope = success.data[0].Quantity;
                            B_Requests1A_scope = success.data[0].B_Requests1;
                            B_Requests2A_scope = success.data[0].B_Requests2;
                            B_Requests3A_scope = success.data[0].B_Requests3;
                            B_Requests4A_scope = success.data[0].B_Requests4;
                            B_Requests5A_scope = success.data[0].B_Requests5;
                            RNotes1_scope = success.data[0].RNotes;
                            Shipping1_scope = success.data[0].Shipping;
                            _createdAt1_scope = success.data[0]._createdAt.$date;
                            RequestID4_scope = success.data[0]._id;
                            $scope.Buyer_username1 = Buyer_username1_scope;
                            $scope.manufacturer1 = manufacturer1_scope;
                            $scope.Product1 = Product1_scope;
                            $scope.Memory1 = Memory1_scope;
                            $scope.Color1 = Color1_scope;
                            $scope.Kitted1 = Kitted1_scope;
                            $scope.Carrier1 = Carrier1_scope;
                            $scope.Quantity1 = Quantity1_scope;
                            $scope.B_Requests1A = B_Requests1A_scope;
                            $scope.B_Requests2A = B_Requests2A_scope;
                            $scope.B_Requests3A = B_Requests3A_scope;
                            $scope.B_Requests4A = B_Requests4A_scope;
                            $scope.B_Requests5A = B_Requests5A_scope;
                            $scope.RNotes1 = RNotes1_scope;
                            $scope.Shipping1 = Shipping1_scope;
                            $scope._createdAt1 = _createdAt1_scope;
                            $scope.RequestID4 = RequestID4_scope;
                            $scope.miniID = RequestID4_scope.substring(20);
                            //added stuff here
                            $scope.count = -1;
                            $scope.$watch('BidAmount', function(newvalue, oldvalue) {
                                //console.log("bid",$scope.BidAmount)
                                if (isNaN($scope.BidAmount)) {
                                    $scope.priceperunit = 0
                                } else {
                                    $scope.priceperunit = Number($scope.BidAmount) / Number($scope.Quantity1)
                                    $scope.count = $scope.count + 1;
                                }
                            });
                            //added stuuf above
                            /*|button_mapping|onsuccess|40707D72-9839-CE41-614A-E5ECC1D8F358||1577|*/
                        })(success, $scope);
                    },
                    function(error) { // callback to handle request error
                        //Apperyio.navigateTo("Login", {});
                    },
                    function(notify) { // notify callback, can fire few times
                    });
            };
            /**
             * @function gotoPage
             */
            $scope.gotoPage = function() {
                Apperyio.navigateTo("Seller_Home", {});
            };
            /**
             * @function PlaceOffer
             */
            $scope.PlaceOffer = function() {
                //On load screen logic
                var requestData = {};
                //Get Seller User
                var userData = Apperyio.get("dataStorage");
                var AllData = userData.current;
                var username = AllData.username;
                var Seller_username = AllData.username;
                var session = AllData.session;
                var sMail = AllData.email;
                var sCell = AllData.MobilePhone;
                var user_id = AllData.user_id;
                var token = AllData.session;
                var goTxt = AllData.TextOn;
                //Get User  
                if (goTxt === false) {
                    sCell = "noText";
                } else {
                    sCell = AllData.MobilePhone;
                }
                //console.log(username);
                var requestData = {};
                requestData = (function mapping3480($scope) {
                    var requestData = {};
                    requestData.params = {};
                    var Seller_username_scope = $scope.Seller_username;
                    var RequestID4_scope = $scope.RequestID4;
                    var RNotes1_scope = $scope.RNotes1;
                    var B_Requests5A_scope = $scope.B_Requests5A;
                    var B_Requests4A_scope = $scope.B_Requests4A;
                    var B_Requests3A_scope = $scope.B_Requests3A;
                    var B_Requests2A_scope = $scope.B_Requests2A;
                    var B_Requests1A_scope = $scope.B_Requests1A;
                    var Quantity1_scope = $scope.Quantity1;
                    var Carrier1_scope = $scope.Carrier1;
                    var Kitted1_scope = $scope.Kitted1;
                    var Color1_scope = $scope.Color1;
                    var Memory1_scope = $scope.Memory1;
                    var Product1_scope = $scope.Product1;
                    var manufacturer1_scope = $scope.manufacturer1;
                    var Shipping1_scope = $scope.Shipping1;
                    var Buyer_username1_scope = $scope.Buyer_username1;
                    var OfferNotes = ($scope.SellerNotes);
                    var OfferPrice = ($scope.BidAmount);
                    var Condition = ($scope.Condition1);
                    requestData.params.Seller_username = Seller_username_scope;
                    requestData.params.RequestID4 = RequestID4_scope;
                    requestData.params.RNotes = RNotes1_scope;
                    requestData.params.B_Requests5 = B_Requests5A_scope;
                    requestData.params.B_Requests4 = B_Requests4A_scope;
                    requestData.params.B_Requests3 = B_Requests3A_scope;
                    requestData.params.B_Requests2 = B_Requests2A_scope;
                    requestData.params.B_Requests1 = B_Requests1A_scope;
                    requestData.params.Quantity = Quantity1_scope;
                    requestData.params.Carrier = Carrier1_scope;
                    requestData.params.Color = Color1_scope;
                    requestData.params.Memory = Memory1_scope;
                    requestData.params.Product = Product1_scope;
                    requestData.params.Shipping = Shipping1_scope;
                    requestData.params.manufacturer = manufacturer1_scope;
                    requestData.params.Buyer_username = Buyer_username1_scope;
                    requestData.params.Seller_username = Seller_username;
                    requestData.params.OfferNotes = OfferNotes;
                    requestData.params.OfferPrice = OfferPrice;
                    requestData.params.Condition = Condition;
                    requestData.params.Kitted = Kitted1_scope;
                    requestData.params.S_Offers1 = sMail;
                    requestData.params.S_Offers2 = sCell;
                    requestData.params.S_Offers3 = user_id;
                    requestData.headers = {};
                    var token_scope = $scope.token;
                    requestData.headers['X-Appery-Session-Token'] = token;
                    // console.log("token",token);
                    return requestData;
                    /*|button_mapping|onbeforesend|061FD875-61E6-1D52-3B68-23238C2E995D||3480|*/
                })($scope);
                // read more about using rest services: https://links.appery.io/ve-snippet-rest
                Apperyio.get("InsertOffers_service")(requestData).then(
                    /*|service_bookmark|bookmark|061FD875-61E6-1D52-3B68-23238C2E995D||9919|*/
                    function(success) { // success callback
                        /*|button_mapping|onsuccess|061FD875-61E6-1D52-3B68-23238C2E995D||2123|*/
                        var modalOptions = { // About Ionic Modal: https://links.appery.io/ve-snippet-modal-ionic
                            animation: 'slide-in-up', // The animation to show & hide with
                            focusFirstInput: false, // Whether to autofocus the first input of the modal when shown
                            backdropClickToClose: true, // Whether to close the modal on clicking the backdrop
                            hardwareBackButtonClose: true // Whether the modal can be closed using the hardware back button on Android and similar devices
                        };
                        Apperyio.get('Modals').loadModal("Modal_Seller_Accept").then(
                            function(modalInstance) {
                                modalInstance.open(modalOptions).then(function(modal) {
                                    modal.scope.modal = modal;
                                    modal.scope.result = "You have offered the following:";
                                    modal.scope.result1 = $scope.manufacturer1;
                                    modal.scope.result2 = $scope.Product1;
                                    modal.scope.result3 = $scope.Memory1;
                                    modal.scope.result4 = $scope.Color1;
                                    modal.scope.result5 = $scope.Condition1;
                                    modal.scope.result6 = $scope.Quantity1;
                                    modal.scope.result8 = $scope.Shipping1;
                                    modal.scope.result7 = $scope.BidAmount;
                                    modal.scope.result9 = $scope.Kitted1;
                                    modal.show();
                                });
                            },
                            function(error) {
                                //console.log(error);
                            });
                    },
                    function(error) { // callback to handle request error
                        alert('Please Enter a Price (example: 99.99)');
                        Apperyio.navigateTo("Seller_Accept_Request", {});
                    },
                    function(notify) { // notify callback, can fire few times
                    });
                Apperyio.navigateTo("Seller_Offers", {});
            };
        }
    });